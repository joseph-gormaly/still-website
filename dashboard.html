<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | STILL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/logo_v0.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <header class="bg-white border-b sticky top-0 z-[1000] py-4">
        <div class="container mx-auto px-4">
            <nav class="flex justify-between items-center flex-wrap" role="navigation" aria-label="Main Navigation">
                <a href="index.html" class="flex items-center font-serif font-bold text-2xl text-[#2c3e50] hover:no-underline">
                    <img src="assets/logo_v0.png" alt="STILL Logo" class="h-10 w-auto mr-3">
                    STILL
                </a>
                <button class="mobile-menu-toggle block md:hidden p-2" aria-label="Toggle navigation">
                    <span class="block w-6 h-0.5 bg-gray-600 mb-1"></span>
                    <span class="block w-6 h-0.5 bg-gray-600 mb-1"></span>
                    <span class="block w-6 h-0.5 bg-gray-600"></span>
                </button>
                <ul class="nav-links hidden md:flex list-none m-0 p-0 gap-6 items-center">
                    <li><a href="index.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">Home</a></li>
                    <li><a href="about.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">About</a></li>
                    <li><a href="resume.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">Resume</a></li>
                    <li><a href="projects.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">Research Labs</a></li>
                    <li><a href="timeline.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">Timeline</a></li>
                    <li><a href="dashboard.html" class="font-medium text-blue-500 border-b-2 border-green-500 hover:no-underline">Dashboard</a></li>
                    <li><a href="bsv-calculator.html" class="font-medium text-gray-900 hover:text-blue-500 hover:no-underline">BSV Calculator</a></li>
                    <li><a href="https://commerce.coinbase.com/checkout/bfaaf80e-dfa5-485a-b93f-b0f4b11cb4b4" class="bg-[#2c3e50] text-white px-4 py-2 rounded hover:bg-gray-800 hover:no-underline" target="_blank" rel="noopener noreferrer">Support</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="bg-[#1a252f] text-white py-12 min-h-[calc(100vh-80px)]">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-5xl font-serif font-bold text-center mb-2">Field Dashboard</h1>
            <p class="text-center text-gray-400 mb-8">Interactive GIS-based Territory & Ecosystem Monitor</p>

            <div class="max-w-[1200px] mx-auto bg-[#2c3e50] rounded-xl overflow-hidden shadow-2xl border border-[#34495e]">
                <div id="map" class="h-[600px] w-full z-10"></div>
            </div>

            <div class="bg-[#2c3e50]/95 backdrop-blur-md p-6 rounded-xl mt-6 max-w-[1200px] mx-auto border border-white/10">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-white/5 rounded-lg border-l-4 border-green-500">
                        <span class="text-xs text-gray-400 block mb-2 uppercase tracking-widest">Indigenous Territory</span>
                        <span class="text-2xl font-bold" id="territory-name">Locating...</span>
                    </div>
                    <div class="p-4 bg-white/5 rounded-lg border-l-4 border-green-500">
                        <span class="text-xs text-gray-400 block mb-2 uppercase tracking-widest">Human Development Index</span>
                        <span class="text-2xl font-bold">0.929</span>
                    </div>
                    <div class="p-4 bg-white/5 rounded-lg border-l-4 border-green-500">
                        <span class="text-xs text-gray-400 block mb-2 uppercase tracking-widest">Biodiversity Intactness</span>
                        <span class="text-2xl font-bold">84%</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-6 justify-center flex-wrap">
                <button class="bg-green-600 text-white rounded-full px-6 py-3 font-semibold hover:bg-green-700 hover:-translate-y-0.5 transition-all flex items-center gap-2" id="btn-protected">üõ°Ô∏è Protected Areas</button>
                <button class="bg-green-600 text-white rounded-full px-6 py-3 font-semibold hover:bg-green-700 hover:-translate-y-0.5 transition-all flex items-center gap-2" id="btn-ecosystems">üå≤ Tree Cover</button>
                <button class="bg-green-600 text-white rounded-full px-6 py-3 font-semibold hover:bg-green-700 hover:-translate-y-0.5 transition-all flex items-center gap-2" id="btn-satellite">üõ∞Ô∏è Satellite View</button>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="container">
            <p>&copy; 2026 STILL | Sustainable Transformation Initiative for Land & Learning</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet@3.0.12/dist/esri-leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const map = L.map('map', {
                preferCanvas: true
            }).setView([54.5, -97.5], 5);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO'
            }).addTo(map);

            const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri'
            });

            // Layer 1: WDPA Protected Areas (Dynamic Map Layer is often more reliable than Feature Layer for large datasets)
            const protectedAreas = L.esri.dynamicMapLayer({
                url: 'https://services.arcgis.com/P3ePLMYs2RVChqtp/arcgis/rest/services/World_Database_on_Protected_Areas/MapServer',
                opacity: 0.5,
                useCors: false
            });

            // Layer 2: Tree Cover (Esri 2020 Land Cover)
            const treeCover = L.tileLayer('https://tiles.arcgis.com/tiles/P3ePLMYs2RVChqtp/arcgis/rest/services/Esri_2020_Land_Cover_V2/MapServer/tile/{z}/{y}/{x}', {
                opacity: 0.7,
                attribution: 'Esri 2020 Land Cover'
            });

            let protectedActive = false;
            document.getElementById('btn-protected').addEventListener('click', function() {
                protectedActive = !protectedActive;
                if (protectedActive) { 
                    protectedAreas.addTo(map); 
                    this.classList.replace('bg-green-600', 'bg-slate-700');
                    this.classList.add('ring-2', 'ring-green-500');
                } else { 
                    map.removeLayer(protectedAreas); 
                    this.classList.replace('bg-slate-700', 'bg-green-600');
                    this.classList.remove('ring-2', 'ring-green-500');
                }
            });

            let ecosystemsActive = false;
            document.getElementById('btn-ecosystems').addEventListener('click', function() {
                ecosystemsActive = !ecosystemsActive;
                if (ecosystemsActive) { 
                    treeCover.addTo(map); 
                    this.classList.replace('bg-green-600', 'bg-slate-700');
                    this.classList.add('ring-2', 'ring-green-500');
                } else { 
                    map.removeLayer(treeCover); 
                    this.classList.replace('bg-slate-700', 'bg-green-600');
                    this.classList.remove('ring-2', 'ring-green-500');
                }
            });

            let satelliteActive = false;
            document.getElementById('btn-satellite').addEventListener('click', function() {
                satelliteActive = !satelliteActive;
                if (satelliteActive) { 
                    satellite.addTo(map); 
                    this.classList.replace('bg-green-600', 'bg-slate-700');
                    this.classList.add('ring-2', 'ring-green-500');
                } else { 
                    map.removeLayer(satellite); 
                    this.classList.replace('bg-slate-700', 'bg-green-600');
                    this.classList.remove('ring-2', 'ring-green-500');
                }
            });

            // Territory Logic
            function queryNativeLand(lat, lng) {
                fetch(`https://native-land.ca/api/index.php?maps=territories&position=${lat},${lng}`)
                    .then(res => res.json())
                    .then(data => {
                        const name = data.length > 0 ? data.map(t => t.properties.Name).join(', ') : 'Data unavailable';
                        document.getElementById('territory-name').textContent = name;
                    });
            }

            map.on('click', e => queryNativeLand(e.latlng.lat, e.latlng.lng));
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const latlng = [p.coords.latitude, p.coords.longitude];
                    map.flyTo(latlng, 8);
                    queryNativeLand(latlng[0], latlng[1]);
                });
            }

            document.querySelector('.mobile-menu-toggle').addEventListener('click', function() {
                document.querySelector('.nav-links').classList.toggle('active');
            });
        });
    </script>
</body>
</html>
